<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>BC Club Staff List</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <style>
      body {
        font-family: "Inter", sans-serif;
        margin: 0;
        background: #f5f6fa;
      }
      #nav-placeholder a.active {
        font-weight: bold;
        text-decoration: underline;
      }
      main {
        padding: 2rem;
        display: flex;
        justify-content: center;
      }
      .form-container {
        background: white;
        padding: 2rem;
        border-radius: 12px;
        max-width: 700px;
        width: 100%;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      }
      fieldset {
        border: 1px solid #ccc;
        padding: 1rem;
        margin-bottom: 1rem;
      }
      label {
        display: block;
        margin: 1rem 0 0.5rem;
      }
      input,
      select,
      textarea {
        padding: 0.5rem;
        margin-top: 0.25rem;
        border-radius: 6px;
        border: 1px solid #ccc;
        width: 100%;
      }
      button {
        margin-top: 1rem;
        padding: 0.5rem 1rem;
        background-color: #3f51b5;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
      }
      button:hover {
        background-color: #303f9f;
      }
    </style>
  </head>
  <body>
    <div id="nav-placeholder"></div>

    <main>
      <div class="form-container">
        <form
          id="staffForm"
          action="https://script.google.com/macros/s/AKfycbzzc8jZFtIoTiP5Mztcssf09c1rxI95MPMBNRp6qWrNmgwH0MwQNAPy1Gk2pzXEFklpgg/exec"
          method="post"
          target="hidden_iframe"
        >
          <fieldset>
            <legend>Club Type</legend>
            <label>
              <input type="radio" name="clubType" value="Adventurer" required />
              Adventurer Club
            </label>
            <label>
              <input type="radio" name="clubType" value="Pathfinder" />
              Pathfinder Club
            </label>
          </fieldset>

          <label>
            Select Club:
            <select name="club" id="clubSelect" required disabled>
              <option value="">-- Select your club --</option>
            </select>
          </label>

          <div id="staffEntries">
            <div class="staff">
              <fieldset>
                <legend>Staff Member</legend>
                <label>Name: <input type="text" name="name" required /></label>
                <label>Email: <input type="email" name="email" /></label>
                <label>
                  Criminal Record Check:
                  <select name="crc" onchange="toggleDateInput(this)">
                    <option value="No">No</option>
                    <option value="Yes">Yes</option>
                  </select>
                </label>
                <label class="crcDateLabel" style="display: none">
                  CRC Expiration:
                  <input type="date" name="crcExpirationDate" disabled />
                </label>
                <label>
                  ACL Abuse Cert:
                  <select name="acl">
                    <option value="No">No</option>
                    <option value="Yes">Yes</option>
                  </select>
                </label>
                <label>
                  First Aid Cert Status:
                  <select
                    name="certificationStatus"
                    onchange="toggleDateInput(this)"
                  >
                    <option value="Not Certified">Not Certified</option>
                    <option value="Certified">Certified</option>
                  </select>
                </label>
                <label class="certDateLabel" style="display: none">
                  Certification Expiration:
                  <input
                    type="date"
                    name="certificationExpirationDate"
                    disabled
                  />
                </label>
                <label>
                  Driver's Abstract:
                  <select name="driversAbstract">
                    <option value="No">No</option>
                    <option value="Yes">Yes</option>
                  </select>
                </label>
                <label>
                  Insurance:
                  <select name="insurance">
                    <option value="No">No</option>
                    <option value="Yes">Yes</option>
                  </select>
                </label>
                <label>
                  Volunteers Approved:
                  <select name="volunteersApproved">
                    <option value="No">No</option>
                    <option value="Yes">Yes</option>
                  </select>
                </label>
                <label>
                  Volunteer Form Submitted:
                  <input type="checkbox" name="volunteerForm" />
                </label>
                <label>
                  Over 19+: <input type="checkbox" name="checkboxage" />
                </label>
              </fieldset>
            </div>
          </div>

          <input type="hidden" name="staffList" id="staffListInput" />

          <button type="button" onclick="addStaffEntry()">+ Add Staff</button>
          <button type="button" onclick="removeStaffEntry()">
            - Remove Last
          </button>
          <button type="submit">Submit</button>
        </form>
      </div>
    </main>

    <iframe name="hidden_iframe" style="display: none"></iframe>

    <script>
      // Load nav
      fetch("nav.html")
        .then((res) => res.text())
        .then((html) => {
          document.getElementById("nav-placeholder").innerHTML = html;
          const current = location.pathname.split("/").pop();
          document.querySelectorAll("#nav-placeholder a").forEach((a) => {
            if (a.getAttribute("href") === current) a.classList.add("active");
          });
        });

      const clubs = {
        Adventurer: [
          { id: "A01", name: "`Lil Titans" },
          { id: "A02", name: "Agape Lynx" },
          { id: "A03", name: "Cariboo Gold" },
          { id: "A04", name: "Creekside Jr. Falcons" },
          { id: "A05", name: "Dawson Creek Peacemakers" },
          { id: "A06", name: "Heavenbound" },
          { id: "A07", name: "Inspire-Burnaby" },
          { id: "A08", name: "Island Eaglets" },
          { id: "A09", name: "Kelowna Silver Paws" },
          { id: "A10", name: "Lake City" },
          { id: "A11", name: "Lakeside" },
          { id: "A12", name: "Mighty Islanders" },
          { id: "A13", name: "Mount Cheam" },
          { id: "A14", name: "Northern Lightbearers" },
          { id: "A15", name: "Orion" },
          { id: "A16", name: "Radical Rabbits" },
          { id: "A17", name: "Sooke Sea Stars" },
          { id: "A18", name: "Surrey Beavers" },
          { id: "A19", name: "Surrey Dolphins" },
          { id: "A20", name: "The Kamloops Eagle" },
          { id: "A21", name: "Vancouver Rangerz" },
          { id: "A22", name: "Westminster Thunderbirds" },
          { id: "A23", name: "White Rock Otters" },
        ],
        Pathfinder: [
          { id: "P01", name: "Agape Lynx" },
          { id: "P02", name: "Cariboo Gold" },
          { id: "P03", name: "Creekside Falcons" },
          { id: "P04", name: "Dawson Creek Peacemakers" },
          { id: "P05", name: "EBENEZER" },
          { id: "P06", name: "Fraser Valley Titans" },
          { id: "P07", name: "Fraserview" },
          { id: "P08", name: "Golden Eagles" },
          { id: "P09", name: "Inspire Jaguars" },
          { id: "P10", name: "Island Eagles" },
          { id: "P11", name: "Island Explorers" },
          { id: "P12", name: "Lake City" },
          { id: "P13", name: "Mount Cheam" },
          { id: "P14", name: "OAC Bears" },
          { id: "P15", name: "Peacelanders" },
          { id: "P16", name: "PG Nighthawks" },
          { id: "P17", name: "Richmond Ravens" },
          { id: "P18", name: "Sardis Spirits" },
          { id: "P19", name: "Shuswap Eagles" },
          { id: "P20", name: "Silver Tip" },
          { id: "P21", name: "Surrey Beavers" },
          { id: "P22", name: "SURREY TIGERS" },
          { id: "P23", name: "Westminster Thunderbirds" },
        ],
      };

      // Populate club select
      document.querySelectorAll('input[name="clubType"]').forEach((radio) => {
        radio.addEventListener("change", () => {
          const select = document.getElementById("clubSelect");
          select.innerHTML = '<option value="">-- Select your club --</option>';
          clubs[radio.value].forEach((club) => {
            const opt = document.createElement("option");
            opt.value = club.name; // only name
            opt.textContent = club.name;
            select.appendChild(opt);
          });
          select.disabled = false;
        });
      });

      function toggleDateInput(sel) {
        const label = sel.closest("label").nextElementSibling;
        if (!label) return;
        if (sel.name === "crc" && label.classList.contains("crcDateLabel")) {
          label.style.display = sel.value === "Yes" ? "block" : "none";
          label.querySelector("input").disabled = sel.value !== "Yes";
        }
        if (
          sel.name === "certificationStatus" &&
          label.classList.contains("certDateLabel")
        ) {
          label.style.display = sel.value === "Certified" ? "block" : "none";
          label.querySelector("input").disabled = sel.value !== "Certified";
        }
      }

      function addStaffEntry() {
        const staffEntries = document.getElementById("staffEntries");
        const last = staffEntries.querySelector(".staff:last-child");
        const clone = last.cloneNode(true);
        clone.querySelectorAll("input, select").forEach((el) => {
          if (el.type === "checkbox") el.checked = false;
          else el.value = "";
          if (el.disabled) el.disabled = false;
        });
        staffEntries.appendChild(clone);
      }

      function removeStaffEntry() {
        const staffEntries = document.getElementById("staffEntries");
        const staffList = staffEntries.querySelectorAll(".staff");
        if (staffList.length > 1)
          staffEntries.removeChild(staffList[staffList.length - 1]);
        else alert("At least one staff entry is required.");
      }

      document
        .getElementById("staffForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          const staffList = [];
          document.querySelectorAll("#staffEntries .staff").forEach((entry) => {
            const get = (name) => entry.querySelector(`[name="${name}"]`);
            staffList.push({
              name: get("name").value.trim(),
              email: get("email").value.trim(),
              crc: get("crc").value,
              crcExpirationDate: get("crcExpirationDate").value,
              acl: get("acl").value,
              certificationStatus: get("certificationStatus").value,
              certificationExpirationDate: get("certificationExpirationDate")
                .value,
              driversAbstract: get("driversAbstract").value,
              insurance: get("insurance").value,
              volunteersApproved: get("volunteersApproved").value,
              volunteerForm: get("volunteerForm").checked,
              checkboxage: get("checkboxage").checked,
            });
          });
          document.getElementById("staffListInput").value =
            JSON.stringify(staffList);
          this.submit();
        });

      flatpickr('input[type="date"]');
    </script>
  </body>
</html>
