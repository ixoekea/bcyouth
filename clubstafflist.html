<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>BC Club Staff List</title>

    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <style>
      body {
        font-family: "Inter", sans-serif;
        margin: 0;
        background: #f5f6fa;
      }
      #nav-placeholder a.active {
        font-weight: bold;
        text-decoration: underline;
      }
      main {
        padding: 2rem;
        display: flex;
        justify-content: center;
      }
      .form-container {
        background: white;
        padding: 2rem;
        border-radius: 12px;
        max-width: 700px;
        width: 100%;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      }
      fieldset {
        border: 1px solid #ccc;
        padding: 1rem;
        margin-bottom: 1rem;
      }
      label {
        display: block;
        margin: 1rem 0 0.5rem;
      }
      input,
      select {
        padding: 0.5rem;
        border-radius: 6px;
        border: 1px solid #ccc;
        width: 100%;
      }
      button {
        margin-top: 1rem;
        padding: 0.5rem 1rem;
        background-color: #3f51b5;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
      }
      button:hover {
        background-color: #303f9f;
      }
      .success-message {
        color: blue;
        margin-top: 1rem;
        font-weight: bold;
      }
      .error-message {
        color: red;
        margin-top: 0.5rem;
        font-weight: bold;
      }
    </style>
  </head>

  <body>
    <div id="nav-placeholder"></div>

    <main>
      <div class="form-container">
        <form
          id="staffForm"
          action="https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec"
          method="post"
          target="hidden_iframe"
        >
          <fieldset>
            <legend>Club Type</legend>
            <label>
              <input type="radio" name="clubType" value="Adventurer" required />
              Adventurer Club
            </label>
            <label>
              <input type="radio" name="clubType" value="Pathfinder" />
              Pathfinder Club
            </label>
          </fieldset>

          <label>
            Select Club:
            <select name="club" id="clubSelect" required disabled>
              <option value="">-- Select your club --</option>
            </select>
          </label>

          <label>
            Access Code:
            <input type="password" name="accessCode" id="accessCode" required />
          </label>
          <div id="accessCodeError" class="error-message" style="display: none">
            Access code is incorrect. Please enter a valid access code.
          </div>

          <div id="staffEntries">
            <div class="staff">
              <fieldset>
                <legend>Staff Member</legend>

                <label>Name: <input type="text" name="name" required /></label>
                <label
                  >Email:
                  <input type="email" name="email" />
                </label>

                <label>
                  Criminal Record Check:
                  <select name="crc" onchange="toggleDateInput(this)">
                    <option>No</option>
                    <option>Yes</option>
                  </select>
                </label>

                <label class="crcDateLabel" style="display: none">
                  CRC Expiration:
                  <input type="date" name="crcExpirationDate" disabled />
                </label>

                <label>
                  First Aid Cert Status:
                  <select
                    name="certificationStatus"
                    onchange="toggleDateInput(this)"
                  >
                    <option>Not Certified</option>
                    <option>Certified</option>
                  </select>
                </label>

                <label class="certDateLabel" style="display: none">
                  Certification Expiration:
                  <input
                    type="date"
                    name="certificationExpirationDate"
                    disabled
                  />
                </label>

                <label>
                  Volunteer Form Submitted:
                  <input type="checkbox" name="volunteerForm" />
                </label>

                <label>
                  Over 19+:
                  <input type="checkbox" name="checkboxage" />
                </label>
              </fieldset>
            </div>
          </div>

          <input type="hidden" name="staffList" id="staffListInput" />

          <button type="button" onclick="addStaffEntry()">+ Add Staff</button>
          <button type="button" onclick="removeStaffEntry()">
            - Remove Last
          </button>
          <button type="submit">Submit</button>

          <div
            id="successMessage"
            class="success-message"
            style="display: none"
          >
            Submission successful!
          </div>
        </form>
      </div>
    </main>

    <iframe name="hidden_iframe" style="display: none"></iframe>

    <script>
      // ---------------- NAV LOADER ----------------
      fetch("nav.html")
        .then((res) => res.text())
        .then((html) => {
          document.getElementById("nav-placeholder").innerHTML = html;
          const current = location.pathname.split("/").pop();
          document.querySelectorAll("#nav-placeholder a").forEach((a) => {
            if (a.getAttribute("href") === current) {
              a.classList.add("active");
            }
          });
        });

      // ---------------- CLUB LISTS ----------------
      const clubs = {
        Adventurer: [
          { name: "`LIL TITANS" },
          { name: "Agape Lynx" },
          { name: "Cariboo Gold" },
          { name: "Chickadee" },
          { name: "Cranbrook SDA Church" },
          { name: "Creekside Jr. Falcons" },
          { name: "Dawson Creek Peacemakers" },
          { name: "Heavenbound" },
          { name: "Inspire-Burnaby" },
          { name: "Island Eaglets" },
          { name: "Island Explorers" },
          { name: "Kelowna Silver Paws" },
          { name: "Lake City" },
          { name: "Lakeside" },
          { name: "Mighty Islanders" },
          { name: "Mount Cheam" },
          { name: "Northern Lightbearers" },
          { name: "Orion" },
          { name: "Penticton SDA Spirit Bears" },
          { name: "Radical Rabbits" },
          { name: "Robson Peaks" },
          { name: "Sooke Sea Stars" },
          { name: "Surrey Beavers" },
          { name: "Surrey Dolphins" },
          { name: "The Kamloops Eagle" },
          { name: "Vancouver Rangerz" },
          { name: "Westminster Thunderbirds" },
          { name: "White Rock Otters" },
        ],
        Pathfinder: [
          { name: "Agape Lynx" },
          { name: "Cariboo Gold" },
          { name: "Cranbrook SDA Church" },
          { name: "Creekside Falcons" },
          { name: "Dawson Creek Peacemakers" },
          { name: "EBENEZER" },
          { name: "Fraser Valley Titans" },
          { name: "Fraserview" },
          { name: "Golden Eagles" },
          { name: "Inspire Jaguars" },
          { name: "Island Eagles" },
          { name: "Island Explorers" },
          { name: "Lake City" },
          { name: "Mount Cheam" },
          { name: "OAC Bears" },
          { name: "Peacelanders" },
          { name: "PG Nighthawks" },
          { name: "Richmond Ravens" },
          { name: "Robson Peaks" },
          { name: "Sardis Spirits" },
          { name: "Shuswap Eagles" },
          { name: "Silver Tip" },
          { name: "Skyhawks" },
          { name: "Surrey Beavers" },
          { name: "SURREY TIGERS" },
          { name: "Westminster Thunderbirds" },
        ],
      };

      document.querySelectorAll('input[name="clubType"]').forEach((radio) => {
        radio.addEventListener("change", () => {
          const select = document.getElementById("clubSelect");
          select.innerHTML = '<option value="">-- Select your club --</option>';
          clubs[radio.value].forEach((club) => {
            const opt = document.createElement("option");
            opt.value = club.name;
            opt.textContent = club.name;
            select.appendChild(opt);
          });
          select.disabled = false;
        });
      });

      // ---------------- ACCESS CODE (FRONT END) ----------------
      const FRONTEND_ACCESS_CODE = "2026BCYOUTHCHOSEN";
      const accessCodeInput = document.getElementById("accessCode");
      const accessCodeError = document.getElementById("accessCodeError");

      accessCodeInput.addEventListener("input", () => {
        accessCodeError.style.display = "none";
      });

      // ---------------- FORM SUBMIT ----------------
      const form = document.getElementById("staffForm");
      const successMessage = document.getElementById("successMessage");

      form.addEventListener("submit", (e) => {
        e.preventDefault();

        if (accessCodeInput.value.trim() !== FRONTEND_ACCESS_CODE) {
          accessCodeError.style.display = "block";
          accessCodeInput.focus();
          return;
        }

        const staffList = [];
        document.querySelectorAll(".staff").forEach((entry) => {
          const g = (n) => entry.querySelector(`[name="${n}"]`);
          staffList.push({
            name: g("name").value,
            email: g("email").value,
            crc: g("crc").value,
            crcExpirationDate: g("crcExpirationDate").value,
            certificationStatus: g("certificationStatus").value,
            certificationExpirationDate: g("certificationExpirationDate").value,
            volunteerForm: g("volunteerForm").checked,
            checkboxage: g("checkboxage").checked,
          });
        });

        document.getElementById("staffListInput").value =
          JSON.stringify(staffList);
        form.submit();
        successMessage.style.display = "block";
      });

      flatpickr('input[type="date"]');
    </script>
  </body>
</html>
