<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>BC Club Annual Application</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
        margin: 0;
        background: #f5f6fa;
      }

      /* Nav placeholder styling same as Staff List page */
      #nav-placeholder a.active {
        font-weight: bold;
        text-decoration: underline;
      }

      main {
        padding: 6rem 2rem 2rem; /* extra top padding for nav */
        display: flex;
        justify-content: center;
      }

      .form-container {
        background: white;
        padding: 2rem;
        border-radius: 12px;
        max-width: 800px;
        width: 100%;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        position: relative;
      }

      h2 {
        color: #3f51b5;
        margin-top: 2rem;
      }

      label {
        display: block;
        margin-top: 1rem;
        font-weight: 600;
      }

      input,
      select {
        width: 100%;
        padding: 0.6rem;
        margin-top: 0.3rem;
        border-radius: 6px;
        border: 1px solid #ccc;
      }

      button {
        margin-top: 1rem;
        padding: 0.6rem 1.2rem;
        background: #3f51b5;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: bold;
      }

      button:hover {
        background: #303f9f;
      }

      .member-row,
      .coach-row {
        display: flex;
        gap: 10px;
        align-items: center;
        margin-top: 5px;
      }

      .member-row input,
      .member-row select,
      .coach-row input,
      .coach-row select {
        flex: 1;
      }

      .remove-btn {
        background: red;
        color: white;
      }

      .info-note {
        margin: 10px 0;
        font-style: italic;
        color: #555;
      }

      hr {
        margin: 2rem 0;
      }
    </style>
  </head>
  <body>
    <!-- Nav placeholder (fetches nav.html like Staff List page) -->
    <div id="nav-placeholder"></div>

    <main>
      <form
        id="pbeForm"
        class="form-container"
        action="https://script.google.com/macros/s/AKfycbwnwnr59JWDkIXi6-qvkOXZh7bTYpIniwAmIrtNcS3cuEwxgEEmKQHZzyCTIL4lh42flA/exec"
        method="post"
        target="hidden_iframe"
      >
        <h2>Club & Church Information</h2>
        <p class="info-note">Registration Deadline: January 29th, 2026</p>
        <label>Pathfinder Club Name</label>
        <input name="clubName" type="text" required />
        <label>Club Region</label>
        <select name="clubRegion" required>
          <option value="">Select region</option>
          <option value="Cariboo">Cariboo</option>
          <option value="Fraser Valley">Fraser Valley</option>
          <option value="Interior">Interior</option>
          <option value="Kootneys">Kootneys</option>
          <option value="Metro Vancouver 1">Metro Vancouver 1</option>
          <option value="Metro Vancouver 2">Metro Vancouver 2</option>
          <option value="Metro Vancouver 3">Metro Vancouver 3</option>
          <option value="Northern Interior">Northern Interior</option>
          <option value="North Okanagan">North Okanagan</option>
          <option value="South Okanagan">South Okanagan</option>
          <option value="Vancouver Islands">Vancouver Islands</option>
        </select>
        <label>Director Name</label>
        <input name="directorName" type="text" required />
        <label>Church Name</label>
        <input name="churchName" type="text" required />

        <hr />
        <h2>General Team Information</h2>
        <label>PBE Team Name</label>
        <input name="teamName" type="text" required />
        <label>Team Coach First Name</label>
        <input name="coachFirstName" type="text" required />
        <label>Team Coach Last Name</label>
        <input name="coachLastName" type="text" required />
        <label>Team Coach Email</label>
        <input name="coachEmail" type="email" required />
        <label>Team Coach Phone Number</label>
        <input name="coachPhone" type="tel" required />

        <hr />
        <h2>Alternate Coaches</h2>
        <div id="altCoachesContainer"></div>
        <button type="button" id="addAltCoach">+ Add Alternate Coach</button>

        <hr />
        <h2>Team Members</h2>
        <div id="membersContainer"></div>
        <button type="button" id="addMember">+ Add Member</button>

        <hr />
        <h2>Confirmation</h2>
        <label>
          Please confirm all team members are inducted as Pathfinder members:
        </label>
        <select name="clubConfirmation" required>
          <option value="">Select</option>
          <option value="Yes">Yes</option>
          <option value="No">No</option>
        </select>

        <input type="hidden" name="teamData" id="teamData" />
        <button type="submit">Submit Registration</button>
      </form>
    </main>

    <iframe name="hidden_iframe" style="display: none"></iframe>

    <script>
      // Load nav exactly like Staff List page
      fetch("nav.html")
        .then((res) => res.text())
        .then((html) => {
          document.getElementById("nav-placeholder").innerHTML = html;
          const current = location.pathname.split("/").pop();
          document.querySelectorAll("#nav-placeholder a").forEach((a) => {
            if (a.getAttribute("href") === current) a.classList.add("active");
          });
        });

      // Add members dynamically
      const membersContainer = document.getElementById("membersContainer");
      document.getElementById("addMember").addEventListener("click", () => {
        const div = document.createElement("div");
        div.className = "member-row";
        div.innerHTML = `
          <input type="text" name="memberFirstName" placeholder="First Name" required/>
          <input type="text" name="memberLastName" placeholder="Last Name" required/>
          <select name="memberRole" required>
            <option value="">Role</option>
            <option value="Captain">Captain</option>
            <option value="Scribe">Scribe</option>
            <option value="Member">Member</option>
            <option value="Alternate">Alternate</option>
          </select>
          <button type="button" class="remove-btn">-</button>
        `;
        membersContainer.appendChild(div);
        div
          .querySelector(".remove-btn")
          .addEventListener("click", () => div.remove());
      });

      // Add alternate coaches dynamically
      const altContainer = document.getElementById("altCoachesContainer");
      document.getElementById("addAltCoach").addEventListener("click", () => {
        const div = document.createElement("div");
        div.className = "coach-row";
        div.innerHTML = `
          <input type="text" name="altCoachFirst" placeholder="First Name" required/>
          <input type="text" name="altCoachLast" placeholder="Last Name" required/>
          <input type="email" name="altCoachEmail" placeholder="Email" required/>
          <input type="tel" name="altCoachPhone" placeholder="Phone" required/>
          <button type="button" class="remove-btn">-</button>
        `;
        altContainer.appendChild(div);
        div
          .querySelector(".remove-btn")
          .addEventListener("click", () => div.remove());
      });

      // Form submission
      const form = document.getElementById("pbeForm");
      const iframe = document.querySelector('iframe[name="hidden_iframe"]');

      form.addEventListener("submit", function (e) {
        e.preventDefault();

        const formData = Object.fromEntries(new FormData(form).entries());

        // Members
        const members = [];
        document
          .querySelectorAll("#membersContainer .member-row")
          .forEach((row) => {
            const get = (name) => row.querySelector(`[name="${name}"]`);
            members.push({
              firstName: get("memberFirstName").value,
              lastName: get("memberLastName").value,
              role: get("memberRole").value,
            });
          });

        // Alt coaches
        const altCoaches = [];
        document
          .querySelectorAll("#altCoachesContainer .coach-row")
          .forEach((row) => {
            const get = (name) => row.querySelector(`[name="${name}"]`);
            altCoaches.push({
              firstName: get("altCoachFirst").value,
              lastName: get("altCoachLast").value,
              email: get("altCoachEmail").value,
              phone: get("altCoachPhone").value,
            });
          });

        document.getElementById("teamData").value = JSON.stringify({
          ...formData,
          members,
          altCoaches,
        });

        const submitBtn = form.querySelector('button[type="submit"]');
        submitBtn.disabled = true;
        submitBtn.textContent = "Submitting...";

        iframe.onload = () => {
          alert("âœ… Registration submitted successfully!");
          form.reset();
          membersContainer.innerHTML = "";
          altContainer.innerHTML = "";
          submitBtn.disabled = false;
          submitBtn.textContent = "Submit Registration";
        };

        form.submit();
      });
    </script>
  </body>
</html>
