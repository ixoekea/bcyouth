<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>BC PBE Registration</title>

    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
      rel="stylesheet"
    />

    <style>
      body {
        font-family: "Inter", sans-serif;
        margin: 0;
        background: #f5f6fa;
      }

      #nav-placeholder a.active {
        font-weight: bold;
        text-decoration: underline;
      }

      main {
        padding: 6rem 2rem 2rem;
        display: flex;
        justify-content: center;
      }

      .form-container {
        background: white;
        padding: 2rem;
        border-radius: 12px;
        max-width: 800px;
        width: 100%;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      }

      h2 {
        color: #3f51b5;
        margin-top: 2rem;
      }

      h3 {
        margin-top: 1.5rem;
        color: #444;
      }

      label {
        display: block;
        margin-top: 1rem;
        font-weight: 600;
      }

      input,
      select {
        width: 100%;
        padding: 0.6rem;
        margin-top: 0.3rem;
        border-radius: 6px;
        border: 1px solid #ccc;
      }

      .member-row {
        display: flex;
        gap: 10px;
        margin-top: 0.5rem;
      }

      .member-row input {
        flex: 1;
      }

      .policy-note {
        margin-top: 1rem;
        padding: 0.75rem;
        background: #eef1ff;
        border-left: 4px solid #3f51b5;
        font-size: 0.95rem;
        color: #333;
      }

      button {
        margin-top: 2rem;
        padding: 0.7rem 1.5rem;
        background: #3f51b5;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: bold;
      }

      button:hover {
        background: #303f9f;
      }

      hr {
        margin: 2.5rem 0;
      }
    </style>
  </head>

  <body>
    <div id="nav-placeholder"></div>

    <main>
      <form
        id="pbeForm"
        class="form-container"
        action="https://script.google.com/macros/s/AKfycbwnwnr59JWDkIXi6-qvkOXZh7bTYpIniwAmIrtNcS3cuEwxgEEmKQHZzyCTIL4lh42flA/exec"
        method="post"
        target="hidden_iframe"
      >
        <h2>Club & Church Information</h2>

        <label>Pathfinder Club Name</label>
        <input name="clubName" required />

        <label>Club Region</label>
        <select name="clubRegion" required>
          <option value="">Select region</option>
          <option>Cariboo</option>
          <option>Fraser Valley</option>
          <option>Interior</option>
          <option>Kootneys</option>
          <option>Metro Vancouver 1</option>
          <option>Metro Vancouver 2</option>
          <option>Metro Vancouver 3</option>
          <option>Northern Interior</option>
          <option>North Okanagan</option>
          <option>South Okanagan</option>
          <option>Vancouver Islands</option>
        </select>

        <label>Director Name</label>
        <input name="directorName" required />

        <label>Church Name</label>
        <input name="churchName" required />

        <hr />

        <h2>Team Information</h2>

        <label>PBE Team Name</label>
        <input name="teamName" required />

        <label>Coach First Name</label>
        <input name="coachFirstName" required />

        <label>Coach Last Name</label>
        <input name="coachLastName" required />

        <label>Coach Email</label>
        <input type="email" name="coachEmail" required />

        <label>Coach Phone</label>
        <input type="tel" name="coachPhone" required />

        <hr />

        <h2>Team Members</h2>

        <div class="policy-note">
          <strong>Team Policy:</strong><br />
          • A minimum of <strong>2 team members</strong> is required to
          compete.<br />
          • Team membership is <strong>final upon submission</strong>.<br />
          • <strong>No additional team members may be added</strong> at a later
          date.
        </div>

        <h3>Captain</h3>
        <div class="member-row">
          <input name="captainFirstName" placeholder="First Name" required />
          <input name="captainLastName" placeholder="Last Name" required />
          <input
            type="email"
            name="captainEmail"
            placeholder="Email"
            required
          />
        </div>

        <h3>Scribe</h3>
        <div class="member-row">
          <input name="scribeFirstName" placeholder="First Name" required />
          <input name="scribeLastName" placeholder="Last Name" required />
          <input type="email" name="scribeEmail" placeholder="Email" required />
        </div>

        <h3>Members</h3>
        <div class="member-row">
          <input name="member1FirstName" placeholder="First Name" />
          <input name="member1LastName" placeholder="Last Name" />
        </div>
        <div class="member-row">
          <input name="member2FirstName" placeholder="First Name" />
          <input name="member2LastName" placeholder="Last Name" />
        </div>
        <div class="member-row">
          <input name="member3FirstName" placeholder="First Name" />
          <input name="member3LastName" placeholder="Last Name" />
        </div>
        <div class="member-row">
          <input name="member4FirstName" placeholder="First Name" />
          <input name="member4LastName" placeholder="Last Name" />
        </div>

        <h3>Alternate Member (optional)</h3>
        <div class="member-row">
          <input name="alternateFirstName" placeholder="First Name" />
          <input name="alternateLastName" placeholder="Last Name" />
        </div>

        <hr />

        <h2>Confirmation</h2>
        <label>All team members are inducted Pathfinders?</label>
        <select name="clubConfirmation" required>
          <option value="">Select</option>
          <option>Yes</option>
          <option>No</option>
        </select>

        <input type="hidden" name="teamData" id="teamData" />

        <button type="submit">Submit Registration</button>
      </form>
    </main>

    <iframe name="hidden_iframe" style="display: none"></iframe>

    <script>
      fetch("nav.html")
        .then((res) => res.text())
        .then((html) => {
          document.getElementById("nav-placeholder").innerHTML = html;
          const current = location.pathname.split("/").pop();
          document.querySelectorAll("#nav-placeholder a").forEach((a) => {
            if (a.getAttribute("href") === current) a.classList.add("active");
          });
        });

      const form = document.getElementById("pbeForm");
      const iframe = document.querySelector('iframe[name="hidden_iframe"]');

      form.addEventListener("submit", function (e) {
        e.preventDefault();

        const fd = new FormData(form);

        // Count total members (captain + scribe + filled member slots)
        let memberCount = 0;

        if (fd.get("captainFirstName") && fd.get("captainLastName"))
          memberCount++;
        if (fd.get("scribeFirstName") && fd.get("scribeLastName"))
          memberCount++;

        ["member1", "member2", "member3", "member4"].forEach((m) => {
          if (fd.get(m + "FirstName") && fd.get(m + "LastName")) {
            memberCount++;
          }
        });

        if (memberCount < 2) {
          alert(
            "A minimum of 2 team members is required before submitting this registration.",
          );
          return;
        }

        const formData = Object.fromEntries(fd.entries());
        document.getElementById("teamData").value = JSON.stringify(formData);

        const btn = form.querySelector("button[type='submit']");
        btn.disabled = true;
        btn.textContent = "Submitting...";

        iframe.onload = () => {
          alert("✅ Registration submitted successfully!");
          form.reset();
          btn.disabled = false;
          btn.textContent = "Submit Registration";
        };

        form.submit();
      });
    </script>
  </body>
</html>
